# Operations: Logging & Tracing

Practical tips for finding, filtering, and understanding Inspect logs and traces generated by the Inspect‑AI path in this repo, including how approval decisions appear.

## Where artifacts go
- CLI runs (inspect eval …): specify `--log-dir logs` to write `.eval` JSONL logs and enable viewer. 〖F:docs/getting-started/inspect_console_cheatsheet.md†L89-L95〗
- Python path: the transcript writer defaults to `.inspect/logs`; override with `INSPECT_LOG_DIR`. 〖F:docs/getting-started/inspect_agents_quickstart.md†L137-L140〗 〖F:docs/reference/environment.md†L172-L185〗

## Quick commands
```bash
# List available logs
uv run inspect log list --log-dir logs

# Dump a log as JSONL to the console
uv run inspect log dump logs/<run>.eval | jq

# Start the visual log viewer and open the printed URL
uv run inspect view start --log-dir logs

# Traces (timing/HTTP/errors)
uv run inspect trace list
uv run inspect trace dump logs/inspect_ai/trace.log | jq
```

## Approvals in logs
Inspect emits dedicated approval records; filter your log for `event=="approval"` to see decisions:

```bash
uv run inspect log dump logs/<run>.eval \
  | jq 'select(.event=="approval") | {tool: .call.function, decision: .decision, explanation: .explanation, approver: .approver}'
```

Data fields for approval events include:
- `event`: `"approval"`
- `call`: the original `ToolCall` being approved (function + arguments)
- `decision`: `approve | modify | reject | escalate | terminate`
- `modified`: optional `ToolCall` when decision is `modify`
- `explanation`: optional human‑readable reason

Reference: ApprovalEvent schema in Inspect. 〖F:external/inspect_ai/src/inspect_ai/log/_transcript.py†L336-L361〗

Confirm that policies were configured by inspecting the eval config header:
```bash
uv run inspect log dump logs/<run>.eval | jq '.eval.config.approval'
```
This reflects the active approval policy config at run start. 〖F:external/inspect_ai/src/inspect_ai/log/_log.py†L89〗 〖F:external/inspect_ai/src/inspect_ai/_eval/eval.py†L994〗

## Tool lifecycle logs (repo‑specific)
DeepAgents adds minimal structured log lines for tool starts/ends/errors. They show up as `event=="logger"` in the transcript with a `message` string containing a JSON payload prefixed by `tool_event`.

Examples:
```bash
# Show tool lifecycle messages
uv run inspect log dump logs/<run>.eval \
  | jq 'select(.event=="logger" and (.message.message|test("^tool_event "))) | .message.message'
```

Fields include `tool`, `phase` (`start|end|error`), optional `duration_ms`, and redacted/truncated `args`.
- Redaction keys: `api_key`, `authorization`, `token`, `password`, `file_text`, `content`. 〖F:src/inspect_agents/approval.py†L113-L124〗
- Truncation: long string fields shortened (default 200 chars) — set `INSPECT_TOOL_OBS_TRUNCATE` to adjust. 〖F:src/inspect_agents/tools.py†L46-L53〗 〖F:src/inspect_agents/tools.py†L79-L116〗

## Common patterns
- Find all approval rejections/terminations:
```bash
uv run inspect log dump logs/<run>.eval \
  | jq 'select(.event=="approval" and (.decision=="reject" or .decision=="terminate")) | {tool:.call.function, decision:.decision, why:.explanation}'
```

- Find long‑running tools (duration ≥ 1s) from our tool logs:
```bash
uv run inspect log dump logs/<run>.eval \
  | jq 'select(.event=="logger" and (.message.message|test("^tool_event "))) \
        | (.message.message | capture("duration_ms\\": (?<ms>[0-9.]+)") | .ms // 0) as $ms \
        | select(($ms|tonumber) >= 1000) | .message.message'
```

## Troubleshooting
- “I enabled approvals but don’t see any decisions”: ensure your policy actually matches the tool names (use exact names or globs) and that approvals were initialized; confirm with `.eval.config.approval` as shown above.
- “Logger events are noisy”: raise `INSPECT_TOOL_OBS_TRUNCATE` to shorten payloads or switch console display mode to `--display log`.
- “Sandbox/file ops aren’t hitting host FS”: in sandbox mode, tools preflight the sandbox; on failure they fall back to the in‑memory store and log a one‑time warning (`files:sandbox_preflight`). 〖F:src/inspect_agents/tools_files.py†L65-L86〗

## See also
- Approvals how‑to: ./approvals.md
- Filesystem how‑to: ./filesystem.md
- Environment reference: ../reference/environment.md
